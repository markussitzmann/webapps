#!/bin/bash

source ./appserver.env

if [ -z "$1" ]; then
    echo "Please specify a database container name and a dump file name in '$APPSERVER_HOME/pg-dump' directory (only file name, no path names). Exit!"
    exit 0;
fi;

CMD="\
    echo Performing drop, create, restore db &&\
    echo DROPDB -h $1 -p 5432 -U $POSTGRES_USER $POSTGRES_USER  &&\
	dropdb -h $1 -p 5432 -U $POSTGRES_USER $POSTGRES_USER &&\
	echo CREATEDB -h $1 -p 5432 -U $POSTGRES_USER $POSTGRES_USER &&\
	createdb -h $1 -p 5432 -U $POSTGRES_USER $POSTGRES_USER &&\
	echo PG_RESTORE -h $1 -p 5432 -U $POSTGRES_USER -d $POSTGRES_USER /home/appserver/pg-dump/$2 && \
	pg_restore -h $1 -p 5432 -U $POSTGRES_USER -d $POSTGRES_USER /home/appserver/pg-dump/$2"


docker-compose run --rm shell bash -ci "$CMD"